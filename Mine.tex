\documentclass[[12pt,a4paper,twoside,openrigh]{article} 

\usepackage{indentfirst}
\usepackage{makeidx}
\usepackage{pdfpages}
\usepackage[italian]{babel}
\usepackage[latin1]{inputenc}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{stmaryrd}
\usepackage{amsfonts}
\usepackage{mathtools}
\usepackage{xspace}
\usepackage{infer}
\usepackage{float}
\usepackage[all]{xy}
\usepackage{array}
\usepackage{version}
\usepackage{verbatim} 
\usepackage{balance}
\usepackage{enumerate}
\usepackage{fullpage}
\usepackage{pifont}
\usepackage[textsize=footnotesize,backgroundcolor=white,linecolor=black]{todonotes}
\usepackage{xifthen}

\floatstyle{ruled}
\restylefloat{table}

\newtheorem{definition}{Definition}
\newtheorem{lemma}{Lemma}
\newtheorem{theorem}{Theorem}
\newtheorem{proposition}{Proposition}

\newcommand{\vat}[0]{\hat{v}}
\newcommand{\Cat}[0]{\hat{C}}
\newcommand{\muat}[0]{\hat{\mu}}
\newcommand{\Rat}[0]{\hat{R}}
\newcommand{\Pat}[0]{\hat{P}}
\newcommand{\modelrho}{\models_{\rho_s}}
\newcommand{\aenvs}{(\Rat,\muat)}
\newcommand{\caesti}[2]{\aenvs \modelrho #1 : \vat_{#2} \gg \rho_{#2}}
\newcommand{\caest}[1]{\aenvs \modelrho #1 : \vat \gg \rho}
\newcommand{\cenvs}{(\Cat,\Rat,\muat,\Pat)}
\newcommand{\ccest}[1]{\cenvs \models_{c \rho_s} #1}
\newcommand{\ccestl}[1]{\cenvs \models_{c \rho_s} {(#1)}^{\ell}}
\newcommand{\lbt}[1]{{t_#1}^{\ell_#1}}
\newcommand{\letexprs}[3]{\mathbf{let}\ \vec{#1 = #2}\ \mathbf{in}\ #3}

\author{Michele Bugliesi \and Stefano Calzavara \and Silvia Crafa \and Enrico Steffinlongo}
\title{Static Enforcement of Least Privilege in Google Chrome Extensions}

\input{macros}

\makeindex
\begin{document}
\maketitle
\tableofcontents

\section{Security Rules}
\section{Abstract succint}
\[
\begin{array}{llcl}
\mathit{Abstract\ cache} & \Cat & : & \labs \rightarrow \absvalues \\
\mathit{Abstract\ variable\ environment} & \Rat & : & \vars \rightarrow \absvalues \\
\mathit{Abstract\ memory} & \absmem & : & \labs \times \perms \rightarrow \absvalues \\
\mathit{Abstract\ permission\ cache} & \Pat & : & \labs \rightarrow \perms \\
\end{array}
\]
\begin{tabular}{l l l}
{[\textit{PE-Val}]} \\
$\aenvs \modelrho c : \vat$ & iff & $\{d_c\} \subseteq \vat$ \\ 
{[\textit{PE-Var}]} \\
$\aenvs \modelrho x : \vat$ & iff & $\Rat(x) \subseteq \vat$ \\ 
{[\textit{PE-Lambda}]} \\
$\aenvs \modelrho \lam{x}{e} : \vat$ & iff & $\{\lam{x}{e}\} \subseteq \vat$ \\
{[\textit{PE-Obj}]} \\
$\caest {\rec{\vec{str_i : e_i}}}$ & iff & $\forall i: \caesti {e_i} {i} \wedge$\\
&& $\rec{\vec{str_i :\vat_i}} \subseteq \vat \wedge$ \\
&& $\bigsqcup_{i} \rho_i \sqsubseteq \rho$ \\ 
{[\textit{PE-Let}]} \\
$\caest {\letexprs{x_i}{e_i}{e'}}$ & iff & $\aenvs \modelrho e' : \vat \gg \rho' \wedge$ \\
&& $ \forall i: \caesti {e_i} {i} \wedge$ \\
&& $\vat_i \subseteq \Rat(x_i) \wedge$ \\
&& $ \{\rho'\} \join \{\bigsqcup_i \rho_i\} \sqsubseteq \rho$ \\
{[\textit{PE-App}]} \\
$\caest {\appl {e_1} {e_2}}$ & iff & $ \caesti {e_1} {1} \wedge$ \\
&& $\caesti {e_2} {2} \wedge$ \\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $\rho_2 \sqsubseteq \rho \wedge$ \\
&& $\forall (\lam{x}{e_0}) \in \vat_1 : \vat_2 \subseteq \Rat(x) \wedge \caesti {e_0} {0} \wedge \rho_0 \sqsubseteq \rho $\\
{[\textit{PE-Op}]} \\
$\caest {\op (\vec{e_i})} $& iff &$\forall i : \caesti {e_i} {i} \wedge $\\
&& $\rho_i \sqsubseteq \rho$\\
&& $\widehat{op} (\vec{\vat_i}) \subseteq \vat $\\
{[\textit{PE-Cond}]}\\
$\caest {\cond {e_0} {e_1} {e_2}} $& iff &$ \caesti {e_0} {0} \wedge $\\
&& $\rho_0 \sqsubseteq \rho \wedge$ \\
&& $\widehat{\true} \in \vat_0 \Rightarrow \caesti {e_1} {1} \wedge \vat_1 \subseteq \vat \wedge \rho_1 \sqsubseteq \rho \wedge$ \\
&& $\widehat{\false} \in \vat_0 \Rightarrow \caesti {e_2} {2} \wedge \vat_2 \subseteq \vat \wedge \rho_2 \sqsubseteq \rho$ \\
{[\textit{PE-While}]}\\
$\caest {\while {e_1} {e_2}} $& iff &$ \caesti {e_1} {1} \wedge $\\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $\widehat{\true} \in \vat_1 \Rightarrow \caesti {e_2} {2} \wedge \vat_2 \subseteq \vat \wedge \rho_2 \sqsubseteq \rho \wedge$\\
&& $\widehat{\false} \in \vat_1 \Rightarrow \widehat{\undef} \subseteq \vat$\\
{[\textit{PE-GetField}]}\\
$\caest {\lookup {e_1} {e_2}} $& iff &$ \caesti {e_1} {1} \wedge $\\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $ \caesti {e_2} {2} \wedge $ \\
&& $\rho_2 \sqsubseteq \rho \wedge$ \\
&& $\widehat{get} (\vat_1, \vat_2) \subseteq \vat$ \\
{[\textit{PE-SetField}]}\\
$\caest {\store {e_0} {e_1} {e2}} $& iff &$ \caesti {e_0} {0} \wedge $\\
&& $\rho_0 \sqsubseteq \rho \wedge$ \\
&& $ \caesti {e_1} {1} \wedge $ \\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $ \caesti {e_2} {2} \wedge $ \\
&& $\rho_2 \sqsubseteq \rho \wedge$ \\
&& $\widehat{set} (\vat_0, \vat_1, \vat_2) \subseteq \vat$ \\
\end{tabular}
\begin{tabular} {l l l}
{[\textit{PE-DelField}]}\\
$\caest {\delete {e_1} {e_2}} $& iff &$ \caesti {e_1} {1} \wedge $\\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $ \caesti {e_2} {2} \wedge $ \\
&& $\rho_2 \sqsubseteq \rho \wedge$ \\
&& $\widehat{del} (\vat_1, \vat_2) \subseteq \vat$\\
{[\textit{PE-Ref}]}\\
$ \aenvs \modelrho \newref {r,\rho_r} {e} :\{r\} \gg \rho $& iff &$ \caest {e} \wedge $\\
&& $\rho_r \sqsubseteq \rho_s \Rightarrow \vat \subseteq \muat(r, \rho_r) $ \\
{[\textit{PE-DeRef}]}\\
$\caest {\deref {e}} $& iff &$ \caesti {e} {1} \wedge $\\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $\forall r \in \vat_1 : \forall \rho_r \sqsubseteq \rho_s : \muat(r, \rho_r) \subseteq \vat$ \\
{[\textit{PE-SetRef}]}\\
$\caest {\setref {e_1} {e_2}} $& iff &$ \caesti {e} {1} \wedge $\\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $ \caesti {e_2} {2} \wedge $ \\
&& $\rho_2 \sqsubseteq \rho \wedge$ \\
&& $\forall r \in \vat_1 : \forall \rho_r \sqsubseteq \rho_s : \vat_2 \subseteq \muat(r, \rho_r) \wedge$ \\
&& $\vat_2 \subseteq \vat $ \\
{[\textit{PE-Send}]} \dots \\
{[\textit{PE-Err}]} \dots \\
{[\textit{PE-Exercise}]} \dots \\
\end{tabular}



\section{Compositional Verbose}
\begin{tabular}{l l l}
{[\textit{CV-Val}]} \\
$ \ccestl {c} $ & iff & $\{d_c\} \subseteq \Cat(\ell)$ \\ 
{[\textit{CV-Var}]} \\
$ \ccestl {x} $ & iff & $\Rat(x) \subseteq \Cat(\ell)$ \\ 
{[\textit{CV-Lambda}]} \\
$ \ccestl {\lam{x}{e_0}} $ & iff & $\{\lam{x}{e_0}\} \subseteq \Cat(\ell) \wedge $\\
&& $ \ccest {e_o}$ \\
{[\textit{CV-Obj}]} \\
$ \ccestl {\rec{\vec{str_i : \lbt i}}}$ & iff & $\forall i: \ccest {\lbt i} \wedge$\\
&& $ \Pat(\ell_i) \sqsubseteq \Pat(\ell) \wedge$\\ 
&& $\rec{\vec{str_i : \Cat(\ell_i)}} \subseteq \Cat_\ell $ \\
{[\textit{CV-Let}]} \\
$ \ccestl {\letexprs{x_i}{\lbt i}{{t'}^{\ell'}}}$ & iff & $ \ccest {{t'}^{\ell'}} \wedge$ \\
&& $ \Pat(\ell') \sqsubseteq \Pat(\ell) \wedge$\\
&& $ \forall i: \ccest {{t_i}^{\ell_i}} \wedge$ \\
&& $ \Cat(\ell_i) \subseteq \Rat(x_i) \wedge$ \\
&& $ \Pat(\ell_i) \subseteq \Pat(\ell) $ \\
{[\textit{CV-App}]} \\
$ \ccestl {\appl {\lbt 1} {\lbt 2}}$ & iff & $ \ccest {\lbt 1} \wedge \ccest {\lbt 2} \wedge$ \\
&& $\Pat(\ell_1) \sqsubseteq \Pat(\ell) \wedge \Pat(\ell_2) \sqsubseteq \Pat(\ell)$ \\
&& $\forall (\lam{x}{\lbt 0}) \in \Cat(\ell_1) : \Cat(\ell_2) \subseteq \Rat(x) \wedge \Cat(\ell_0) \subseteq \Cat(\ell) \wedge \Pat(\ell_0) \sqsubseteq \Pat(\ell) $\\
{[\textit{CV-Op}]} \\
$ \ccestl {\op (\vec{\lbt i})} $& iff &$\forall i : \ccest {\lbt i} \wedge $\\
&& $\Pat(\ell_i) \sqsubseteq \Pat(\ell) \wedge$\\
&& $\widehat{op} (\Cat(\ell_i)) \subseteq \Cat(\ell) $\\
{[\textit{CV-Cond}]}\\
$\cenvs \models_{c \rho_s} $& iff &$ \ccest {\lbt 0} \wedge $\\
$(\cond {\lbt 0} {\lbt 1} {\lbt 2})^\ell$&& $\Pat(\ell_0) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $\widehat{\true} \in \Cat(\ell_0) \Rightarrow \ccest {\lbt 1} \wedge \Cat(\ell_1) \subseteq \Cat(\ell) \wedge \Pat(\ell_1) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $\widehat{\false} \in \Cat(\ell_0) \Rightarrow \ccest {\lbt 2} \wedge \Cat(\ell_2) \subseteq \Cat(\ell) \wedge \Pat(\ell_2) \sqsubseteq \Pat(\ell)$ \\
{[\textit{CV-While}]}\\
$\ccestl {\while {\lbt 1} {\lbt 2}} $& iff &$ \ccest {\lbt 1} \wedge $\\
&& $\Pat(\ell_1) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $\widehat{\true} \in \Cat(\ell_1) \Rightarrow \ccest {\lbt 2} \wedge \Cat(\ell_2) \subseteq \Cat(\ell) \wedge \Pat(\ell_2) \sqsubseteq \Pat(\ell) \wedge$\\
&& $\widehat{\false} \in \Cat(\ell_1) \Rightarrow \widehat{\undef} \subseteq \Cat(\ell)$\\
{[\textit{CV-GetField}]}\\
$\ccestl {\lookup {\lbt 1} {\lbt 2}} $& iff &$ \ccest {\lbt1} \wedge $\\
&& $\Pat(\ell_1) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $ \ccest {\lbt 2} \wedge $ \\
&& $\Pat(\ell_2) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $\widehat{get} (\Cat(\ell_1), \Cat(\ell_2)) \subseteq \Cat(\ell)$ \\
{[\textit{CV-SetField}]}\\
$\ccestl {\store {\lbt 0} {\lbt 1} {\lbt 2}} $& iff &$ \ccest {\lbt 0} \wedge $\\
&& $\Pat(\ell_0) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $ \ccest {\lbt 1} \wedge $ \\
&& $\Pat(\ell_1) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $ \ccest {\lbt 2} \wedge $ \\
&& $\Pat(\ell_2) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $\widehat{set} (\Cat(\ell_0), \Cat(\ell_1), \Cat(\ell_2)) \subseteq \Cat(\ell)$ \\
\end{tabular}

\begin{tabular} {l l l}
{[\textit{CV-DelField}]}\\
$\ccestl {\delete {\lbt 1} {\lbt 2}} $& iff &$ \ccest {\lbt 1} \wedge $\\
&& $\Pat(\ell_1) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $ \ccest {\lbt 2} \wedge $ \\
&& $\Pat(\ell_2) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $\widehat{del} (\Cat(\ell_1), \Cat(\ell_2)) \subseteq \Cat(\ell)$\\
{[\textit{CV-Ref}]}\\
$ \ccestl {\newref {r,\rho_r} {\lbt 1}} $& iff &$ \ccest {\lbt 1} \wedge $\\
&& $ \{r\} \subseteq \Cat(\ell) \wedge$ \\
&& $ \Pat(\ell_1) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $ \rho_r \sqsubseteq \rho_s \Rightarrow \Cat(\ell_1) \subseteq \muat(r, \rho_r) $ \\
{[\textit{CV-DeRef}]}\\
$\ccestl {\deref {\lbt 1}} $& iff &$ \ccest {\lbt 1}\wedge $\\
&& $\Pat(\ell_1) \sqsubseteq \Pat(\ell) \wedge$ \\
&& $\forall r \in \Cat(\ell_1) : \forall \rho_r \sqsubseteq \rho_s : \muat(r, \rho_r) \subseteq \Cat(\ell)$ \\
{[\textit{CV-SetRef}]}\\
$\ccestl {\setref {\lbt 1} {\lbt 2}} $& iff &$ \ccest {\lbt 1} \wedge $\\
&& $ \Pat(\ell_1) \sqsubseteq \Pat(\ell) \wedge $ \\
&& $ \ccest {\lbt 2} \wedge $ \\
&& $ \Pat(\ell_2) \sqsubseteq \Pat(\ell) \wedge $ \\
&& $ \forall r \in \Cat(\ell_1) : \forall \rho_r \sqsubseteq \rho_s : \Cat(\ell_2) \subseteq \muat(r, \rho_r) \wedge$ \\
&& $ \Cat(\ell_2) \subseteq \Cat(\ell) $ \\
{[\textit{PE-Send}]} \dots \\
{[\textit{PE-Err}]} \dots \\
{[\textit{PE-Exercise}]} \dots \\
\end{tabular}

\section{Generation of constraints}
\newcommand{\genl}[1]{\mathcal{C}_*\llbracket (#1)^\ell \rrbracket}
\newcommand{\gen}[1]{\mathcal{C}_*\llbracket (#1) \rrbracket}
\newcommand{\Cel}{\mathsf{C}}
\newcommand{\Rel}{\mathsf{R}}
\newcommand{\Pel}{\mathsf{P}}
\newcommand{\Mel}{\mathsf{M}}
\newcommand{\El}{\mathsf{E}}
Constraint elements: $\El$.
\[
\begin{array}{llcl}
\mathit{Cache element} & \Cel(\ell)& : & \labs \rightarrow \absvalues \\
\mathit{Var element} & \Rel(\ell) & : & \vars \rightarrow \absvalues \\
\mathit{State element} & \Mel(\perms, ref) & : & \labs \times \perms \rightarrow \absvalues \\
\mathit{Permission element} & \Pel(\ell) & : & \labs \rightarrow \perms \\
\end{array}
\]
Constraint form.
\[
\begin{array}{lrcl}
\mathit{Term\ inclusion} & \{\vat\} & \subseteq & \El \\
\mathit{Element\ inclusion} & \El & \subseteq & \El \\
\mathit{Permission\ inclusion} & \Pel(\ell) & \sqsubseteq & \Pel(\ell') \\
\mathit{Operation} & \widehat{Op}(\vec{\mathsf{Inclusion}_i}) & \subseteq & \El \\
\mathit{Implication} & \{\vat\} \subseteq \El & \Rightarrow & \El \subseteq \El \\
\end{array}
\]
Misc:
\[
\begin{array}{l l}
r_* & $is the set of all references of the program;$\\
lambda_* & $is the set of all lambdas of the program;$\\
s_* & $is the set of all reference of the object;$\\
x_* & $is the set of all variable of the let binding;$\\
\end{array}
\]

\begin{tabular}{l l}
{[\textit{CG-Val}]} \\
$ \genl {c} = $ & $\{d_c\} \subseteq \Cel(\ell)$ \\ 
{[\textit{CG-Var}]} \\
$ \genl {x} = $ & $\Rel(x) \subseteq \Cel(\ell)$ \\ 
{[\textit{CV-Lambda}]} \\
$ \genl {\lam{x}{e_0}} = $ & $\{\lam{x}{e_0}\} \subseteq \Cel(\ell) \cup $\\
& $ \gen {e_o} $ \\
{[\textit{CV-Obj}]} \\
$ \gen {\rec{\vec{str_i : \lbt i}}} = $ & $  s : \ccest {\lbt i} \wedge$\\
& $ \Pat(\ell_i) \sqsubseteq \Pat(\ell) \wedge$\\ 
& $\rec{\vec{str_i : \Cat(\ell_i)}} \subseteq \Cat_\ell $ \\
{[\textit{CV-Let}]} \\
$ \gen {\letexprs{x_i}{\lbt i}{{t'}^{\ell'}}} = $ & $ \gen {{t'}^{\ell'}} \cup$ \\
& $ \Pel(\ell') \sqsubseteq \Pel(\ell) \cup$\\
& $ (\forall i: \gen {\lbt i} \cup$ \\
& $ \{\Cel(\ell_i) \subseteq \Rel(x_i)\} \cup$ \\
& $ \{\Pel(\ell_i) \subseteq \Pel(\ell)\}) $ \\
\end{tabular}



\section{The Calculus}
\label{sec:calculus}

%\newpage

\section{Static Semantics}
\label{sec:statics}

%\newpage

\section{Checking Privilege Escalation}
\label{sec:privesc}

\newpage

\section{Making Code More Secure: Unbundling}
\label{sec:flow}

\newpage

\section{Proofs}
\label{sec:proofs}

\newpage

\section{Ideas}
\label{sec:ideas}

\end{document}
