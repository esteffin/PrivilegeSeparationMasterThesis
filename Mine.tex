\documentclass[[12pt,a4paper,twoside,openrigh]{article} 

\usepackage{indentfirst}
\usepackage{makeidx}
\usepackage{pdfpages}
\usepackage[italian]{babel}
\usepackage[latin1]{inputenc}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{stmaryrd}
\usepackage{amsfonts}
\usepackage{mathtools}
\usepackage{xspace}
\usepackage{infer}
\usepackage{float}
\usepackage[all]{xy}
\usepackage{array}
\usepackage{version}
\usepackage{verbatim} 
\usepackage{balance}
\usepackage{enumerate}
\usepackage{fullpage}
\usepackage{pifont}
\usepackage[textsize=footnotesize,backgroundcolor=white,linecolor=black]{todonotes}
\usepackage{xifthen}

\floatstyle{ruled}
\restylefloat{table}

\newtheorem{definition}{Definition}
\newtheorem{lemma}{Lemma}
\newtheorem{theorem}{Theorem}
\newtheorem{proposition}{Proposition}

\newcommand{\vat}[0]{\hat{v}}

\newcommand{\scell}[2][c]{%
  \begin{tabular}[#1]{@{}c@{}}#2\end{tabular}}
\newcommand{\modelrho}{\models_{\rho_s}}
\newcommand{\letexprs}[3]{\mathbf{let}\ \vec{#1 = #2}\ \mathbf{in}\ #3}
\newcommand{\caesti}[2]{C \modelrho #1 : \vat_{#2} \gg \rho_{#2}}
\newcommand{\caest}[1]{C \modelrho #1 : \vat \gg \rho}
\newcommand{\envs}{(C,R,\mu, P)}
\newcommand{\ccesti}[2]{\envs \models_{c \rho_s} (#1)^{#2}}
\newcommand{\ccest}[1]{\envs \models_{c \rho_s} #1}
\newcommand{\ccestl}[1]{\envs \models_{c \rho_s} {(#1)}^{l}}
\newcommand{\lbt}[1]{{t_#1}^{l_#1}}

\author{Michele Bugliesi \and Stefano Calzavara \and Silvia Crafa \and Enrico Steffinlongo}
\title{Static Enforcement of Least Privilege in Google Chrome Extensions}

\input{macros}

\makeindex
\begin{document}
\maketitle
\tableofcontents

\section{Security Rules}
\section{Abstract succint}
\begin{tabular}{l l l}
{[\textit{PE-Val}]} \\
$C \modelrho c : \vat$ & iff & $\{d_c\} \subseteq \vat$ \\ 
{[\textit{PE-Var}]} \\
$C \modelrho x : \vat$ & iff & $R(x) \subseteq \vat$ \\ 
{[\textit{PE-Lambda}]} \\
$C \modelrho \lam{x}{e} : \vat$ & iff & $\{\lam{x}{e}\} \subseteq \vat$ \\
{[\textit{PE-Obj}]} \\
$\caest {\rec{\vec{str_i : e_i}}}$ & iff & $\forall i: \caesti {e_i} {i} \wedge$\\
&& $\rec{\vec{str_i :\vat_i}} \subseteq \vat \wedge$ \\
&& $\bigsqcup_{i} \rho_i \sqsubseteq \rho$ \\ 
{[\textit{PE-Let}]} \\
$\caest {\letexprs{x_i}{e_i}{e'}}$ & iff & $C \modelrho e' : \vat \gg \rho' \wedge$ \\
&& $ \forall i: \caesti {e_i} {i} \wedge$ \\
&& $\vat_i \subseteq R(x_i) \wedge$ \\
&& $ \{\rho'\} \join \{\bigsqcup_i \rho_i\} \sqsubseteq \rho$ \\
{[\textit{PE-App}]} \\
$\caest {\appl {e_1} {e_2}}$ & iff & $ \caesti {e_1} {1} \wedge$ \\
&& $\caesti {e_2} {2} \wedge$ \\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $\rho_2 \sqsubseteq \rho \wedge$ \\
&& $\forall (\lam{x}{e_0}) \in \vat_1 : \vat_2 \subseteq R(x) \wedge \caesti {e_0} {0} \wedge \rho_0 \sqsubseteq \rho $\\
{[\textit{PE-Op}]} \\
$\caest {\op (\vec{e_i})} $& iff &$\forall i : \caesti {e_i} {i} \wedge $\\
&& $\rho_i \sqsubseteq \rho$\\
&& $\widehat{op} (\vec{\vat_i}) \subseteq \vat $\\
{[\textit{PE-Cond}]}\\
$\caest {\cond {e_0} {e_1} {e_2}} $& iff &$ \caesti {e_0} {0} \wedge $\\
&& $\rho_0 \sqsubseteq \rho \wedge$ \\
&& $\widehat{\true} \in \vat_0 \Rightarrow \caesti {e_1} {1} \wedge \vat_1 \subseteq \vat \wedge \rho_1 \sqsubseteq \rho \wedge$ \\
&& $\widehat{\false} \in \vat_0 \Rightarrow \caesti {e_2} {2} \wedge \vat_2 \subseteq \vat \wedge \rho_2 \sqsubseteq \rho$ \\
{[\textit{PE-While}]}\\
$\caest {\while {e_1} {e_2}} $& iff &$ \caesti {e_1} {1} \wedge $\\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $\widehat{\true} \in \vat_1 \Rightarrow \caesti {e_2} {2} \wedge \vat_2 \subseteq \vat \wedge \rho_2 \sqsubseteq \rho \wedge$\\
&& $\widehat{\false} \in \vat_1 \Rightarrow \widehat{\undef} \subseteq \vat$\\
{[\textit{PE-GetField}]}\\
$\caest {\lookup {e_1} {e_2}} $& iff &$ \caesti {e_1} {1} \wedge $\\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $ \caesti {e_2} {2} \wedge $ \\
&& $\rho_2 \sqsubseteq \rho \wedge$ \\
&& $\widehat{get} (\vat_1, \vat_2) \subseteq \vat$ \\
{[\textit{PE-SetField}]}\\
$\caest {\store {e_0} {e_1} {e2}} $& iff &$ \caesti {e_0} {0} \wedge $\\
&& $\rho_0 \sqsubseteq \rho \wedge$ \\
&& $ \caesti {e_1} {1} \wedge $ \\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $ \caesti {e_2} {2} \wedge $ \\
&& $\rho_2 \sqsubseteq \rho \wedge$ \\
&& $\widehat{set} (\vat_0, \vat_1, \vat_2) \subseteq \vat$ \\
\end{tabular}
\begin{tabular} {l l l}
{[\textit{PE-DelField}]}\\
$\caest {\delete {e_1} {e_2}} $& iff &$ \caesti {e_1} {1} \wedge $\\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $ \caesti {e_2} {2} \wedge $ \\
&& $\rho_2 \sqsubseteq \rho \wedge$ \\
&& $\widehat{del} (\vat_1, \vat_2) \subseteq \vat$\\
{[\textit{PE-Ref}]}\\
$ C \modelrho \newref {r,\rho_r} {e} :\{r\} \gg \rho $& iff &$ \caest {e} \wedge $\\
&& $\rho_r \sqsubseteq \rho_s \Rightarrow \vat \subseteq C_{\hat{\mu}}(r, \rho_r) $ \\
{[\textit{PE-DeRef}]}\\
$\caest {\deref {e}} $& iff &$ \caesti {e} {1} \wedge $\\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $\forall r \in \vat_1 : \forall \rho_r \sqsubseteq \rho_s : C_{\hat{\mu}}(r, \rho_r) \subseteq \vat$ \\
{[\textit{PE-SetRef}]}\\
$\caest {\setref {e_1} {e_2}} $& iff &$ \caesti {e} {1} \wedge $\\
&& $\rho_1 \sqsubseteq \rho \wedge$ \\
&& $ \caesti {e_2} {2} \wedge $ \\
&& $\rho_2 \sqsubseteq \rho \wedge$ \\
&& $\forall r \in \vat_1 : \forall \rho_r \sqsubseteq \rho_s : \vat_2 \subseteq C_{\hat{\mu}}(r, \rho_r) \wedge$ \\
&& $\vat_2 \subseteq \vat $ \\
{[\textit{PE-Send}]} \dots \\
{[\textit{PE-Err}]} \dots \\
{[\textit{PE-Exercise}]} \dots \\
\end{tabular}



\section{Compositional Verbose}
\begin{tabular}{l l l}
{[\textit{CV-Val}]} \\
$ \ccestl {c} $ & iff & $\{d_c\} \subseteq C(l)$ \\ 
{[\textit{CV-Var}]} \\
$ \ccestl {x} $ & iff & $R(x) \subseteq C(l)$ \\ 
{[\textit{CV-Lambda}]} \\
$ \ccestl {\lam{x}{e_0}} $ & iff & $\{\lam{x}{e_0}\} \subseteq C(l) \wedge $\\
&& $ \ccest {e_o} \wedge$ \\
{[\textit{CV-Obj}]} \\
$ \ccestl {\rec{\vec{str_i : {t_i}^{l_i}}}}$ & iff & $\forall i: \ccest {{t_i}^{l_i}} \wedge$\\
&& $ P(l_i) \sqsubseteq P(l) \wedge$\\ 
&& $\rec{\vec{str_i : C(l_i)}} \subseteq C_l $ \\
{[\textit{CV-Let}]} \\
$ \ccestl {\letexprs{x_i}{{t_i}^{l_i}}{{t'}^{l'}}}$ & iff & $ \ccest {{t'}^{l'}} \wedge$ \\
&& $ P(l') \sqsubseteq P(l) \wedge$\\
&& $ \forall i: \ccest {{t_i}^{l_i}} \wedge$ \\
&& $ C(l_i) \subseteq R(x_i) \wedge$ \\
&& $ P(l_i) \subseteq P(l) $ \\
{[\textit{CV-App}]} \\
$ \ccestl {\appl {\lbt 1} {\lbt 2}}$ & iff & $ \ccest {\lbt 1} \wedge \ccest {\lbt 2} \wedge$ \\
&& $P(l_1) \sqsubseteq P(l) \wedge P(l_2) \sqsubseteq P(l)$ \\
&& $\forall (\lam{x}{\lbt 0}) \in C(l_1) : C(l_2) \subseteq R(x) \wedge C(l_0) \subseteq C(l) \wedge P(l_0) \sqsubseteq P(l) $\\
{[\textit{CV-Op}]} \\
$ \ccestl {\op (\vec{\lbt i})} $& iff &$\forall i : \ccest {\lbt i} \wedge $\\
&& $P(l_i) \sqsubseteq P(l) \wedge$\\
&& $\widehat{op} (C(l_i)) \subseteq C(l) $\\
{[\textit{CV-Cond}]}\\
$\envs \models_{c \rho_s} $& iff &$ \ccest {\lbt 0} \wedge $\\
$(\cond {\lbt 0} {\lbt 1} {\lbt 2})^l$&& $P(l_0) \sqsubseteq P(l) \wedge$ \\
&& $\widehat{\true} \in C(l_0) \Rightarrow \ccest {\lbt 1} \wedge C(l_1) \subseteq C(l) \wedge P(l_1) \sqsubseteq P(l) \wedge$ \\
&& $\widehat{\false} \in C(l_0) \Rightarrow \ccest {\lbt 2} \wedge C(l_2) \subseteq C(l) \wedge P(l_2) \sqsubseteq P(l)$ \\
{[\textit{CV-While}]}\\
$\ccestl {\while {\lbt 1} {\lbt 2}} $& iff &$ \ccest {\lbt 1} \wedge $\\
&& $P(l_1) \sqsubseteq P(l) \wedge$ \\
&& $\widehat{\true} \in C(l_1) \Rightarrow \ccest {\lbt 2} \wedge C(l_2) \subseteq C(l) \wedge P(l_2) \sqsubseteq P(l) \wedge$\\
&& $\widehat{\false} \in C(l_1) \Rightarrow \widehat{\undef} \subseteq C(l)$\\
{[\textit{CV-GetField}]}\\
$\ccestl {\lookup {\lbt 1} {\lbt 2}} $& iff &$ \ccest {\lbt1} \wedge $\\
&& $P(l_1) \sqsubseteq P(l) \wedge$ \\
&& $ \ccest {\lbt 2} \wedge $ \\
&& $P(l_2) \sqsubseteq P(l) \wedge$ \\
&& $\widehat{get} (C(l_1), C(l_2)) \subseteq C(l)$ \\
{[\textit{CV-SetField}]}\\
$\ccestl {\store {\lbt 0} {\lbt 1} {\lbt 2}} $& iff &$ \ccest {\lbt 0} \wedge $\\
&& $P(l_0) \sqsubseteq P(l) \wedge$ \\
&& $ \ccest {\lbt 1} \wedge $ \\
&& $P(l_1) \sqsubseteq P(l) \wedge$ \\
&& $ \ccest {\lbt 2} \wedge $ \\
&& $P(l_2) \sqsubseteq P(l) \wedge$ \\
&& $\widehat{set} (C(l_0), C(l_1), C(l_2)) \subseteq C(l)$ \\
\end{tabular}

\begin{tabular} {l l l}
{[\textit{CV-DelField}]}\\
$\ccestl {\delete {\lbt 1} {\lbt 2}} $& iff &$ \ccest {\lbt 1} \wedge $\\
&& $P(l_1) \sqsubseteq P(l) \wedge$ \\
&& $ \ccest {\lbt 2} \wedge $ \\
&& $P(l_2) \sqsubseteq P(l) \wedge$ \\
&& $\widehat{del} (C(l_1), C(l_2)) \subseteq C(l)$\\
{[\textit{CV-Ref}]}\\
$ \ccestl {\newref {r,\rho_r} {\lbt 1}} $& iff &$ \ccest {\lbt 1} \wedge $\\
&& $ {r} \subseteq C(l) \wedge$ \\
&& $ P(l_1) \sqsubseteq P(l) \wedge$ \\
&& $ \rho_r \sqsubseteq \rho_s \Rightarrow C(l_1) \subseteq \mu(r, \rho_r) $ \\
{[\textit{CV-DeRef}]}\\
$\ccestl {\deref {\lbt 1}} $& iff &$ \ccest {\lbt 1}\wedge $\\
&& $P(l_1) \sqsubseteq P(l) \wedge$ \\
&& $\forall r \in C(l_1) : \forall \rho_r \sqsubseteq \rho_s : \mu(r, \rho_r) \subseteq C(l)$ \\
{[\textit{CV-SetRef}]}\\
$\ccestl {\setref {\lbt 1} {\lbt 2}} $& iff &$ \ccest {\lbt 1} \wedge $\\
&& $ P(l_1) \sqsubseteq P(l) \wedge $ \\
&& $ \ccest {\lbt 2} \wedge $ \\
&& $ P(l_2) \sqsubseteq P(l) \wedge $ \\
&& $ \forall r \in C(l_1) : \forall \rho_r \sqsubseteq \rho_s : C(l_2) \subseteq \mu(r, \rho_r) \wedge$ \\
&& $ C(l_2) \subseteq C(l) $ \\
{[\textit{PE-Send}]} \dots \\
{[\textit{PE-Err}]} \dots \\
{[\textit{PE-Exercise}]} \dots \\
\end{tabular}
% 
%  $ [\textit{Pe-Var}] $& C \models x : \hat{v}$ iff $\rho(x) \subseteq \hat{v} \\
%  $ [\textit{Pe-Lambda}] $& C \models \lambda{\vec{x_i}}{e_0} : \hat{v}$ iff $\rho(x) \subseteq \hat{v} \\
\section{The Calculus}
\label{sec:calculus}

%\newpage

\section{Static Semantics}
\label{sec:statics}

%\newpage

\section{Checking Privilege Escalation}
\label{sec:privesc}

\newpage

\section{Making Code More Secure: Unbundling}
\label{sec:flow}

\newpage

\section{Proofs}
\label{sec:proofs}

\newpage

\section{Ideas}
\label{sec:ideas}

\end{document}
